name: Deploy master
on:
    push:
        branches: master
        paths:
            - 'server/**/*'
            - 'public/**/*'
            - 'common/**/*'
            - '**.js'
            - 'package.json'
            - 'yarn.lock'
            - 'config.json'

jobs:
    Deploy:
        runs-on: ubuntu-latest
        steps:
            -   name: Deploying...
                uses: appleboy/ssh-action@master
                with:
                    host: ${{ secrets.SSHHOST }}
                    username: ${{ secrets.SSHUSERNAME }}
                    password: ${{ secrets.SSHPASSWORD }}
                    script: |
                        cd /home/delta/dev
                        git reset --hard
                        git pull
                        yarn
                        rm -rfd /home/delta/dev/dist
                        yarn run build
                        pm2 reload /home/delta/ecosystem.config.js --only dev
